package StepDefinition;

import java.awt.AWTException;
import java.awt.Robot;
import java.awt.event.KeyEvent;
import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.TakesScreenshot;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.testng.Assert;
 
import DriverSetup.SetupDriver;
import PageFactory.S1PageFac;
import io.cucumber.datatable.DataTable;
import io.cucumber.java.AfterStep;
import io.cucumber.java.Scenario;
import io.cucumber.java.en.And;
import io.cucumber.java.en.Given;
import io.cucumber.java.en.Then;
import io.cucumber.java.en.When;
public class Search_StepDef {
    static WebDriver driver;
	S1PageFac page;
	
	@Given("user is on homepage of Make My Trip Website")
	public void user_is_on_homepage_of_make_my_trip_website() throws InterruptedException {
		driver=SetupDriver.chromeDriver();
		page=new S1PageFac(driver);
	}
 
	@When("user clicks on the hotels section")
	public void user_clicks_on_the_hotels_section() throws InterruptedException {
        page.hotelClick();
	}
 
	@When("User enters details {string}, {string}, {string} & {string}")
	public void user_enters_details(String Location, String Checkin , String Checkout , String Rooms_Guests) throws AWTException, InterruptedException {
		page.enterLocation(Location);
		page.enterCheckin();
		page.enterCheckout();
//	 page.enterDetails(Location, Checkin, Checkout, Rooms_Guests);
	}
 
	@When("click on Apply button")
	public void click_on_apply_button() throws InterruptedException {
		Thread.sleep(1000);
         page.applyClick();
	}
 
	@When("click on Search button")
	public void click_on_search_button() throws InterruptedException {
		Thread.sleep(1000);
	    page.searchClick();
	}
 
	@Then("relevant hotel options matching the search criteria are displayed")
	public void relevant_hotel_options_matching_the_search_criteria_are_displayed() {
		
		Assert.assertEquals("https://www.makemytrip.com/hotels/hotel-listing/?checkin=04242024&city=CTDEL&checkout=04252024&roomStayQualifier=2e0e&locusId=CTDEL&country=IN&locusType=city&searchText=Delhi&regionNearByExp=3&rsc=1e2e0e", driver.getCurrentUrl());
		//String title=driver.getTitle();
		//Assert.assertTrue(title.contains("Swag Labs"));
	}
/*--------------------------------------------------------------------------------------------------------------------------------*/
	@When("user has preformed a hotel search")
	public void user_has_preformed_a_hotel_search() throws InterruptedException {
		Thread.sleep(3000);
		driver=SetupDriver.chromeDriver();
		page= new S1PageFac(driver);
	    driver.get("https://www.makemytrip.com/hotels/hotel-listing/?checkin=04242024&city=CTDEL&checkout=04252024&roomStayQualifier=2e0e&locusId=CTDEL&country=IN&locusType=city&searchText=Delhi&regionNearByExp=3&rsc=1e2e0e");
//   	    page.searchClick();
	
	}

	@And("user applies filters such as user rating, star category, property type and room amenities etc.")
	public void user_applies_filters_such_as_user_rating_star_category_property_type_and_room_amenities_etc() throws InterruptedException {
	    Thread.sleep(3000);
	    page.applyFilter();
	}

	@Then("search results are updated to reflect the applied filters")
	public void search_results_are_updated_to_reflect_the_applied_filters() {
//	    Assert.assertEquals("https://www.makemytrip.com/hotels/hotel-listing/?_uCurrency=INR&checkin=04242024&checkout=04252024&city=CTDEL&country=IN&filterData=STAR_RATING%7C3%5EUSER_RATING_MMT_BRAND%7C4.2%5EMERGE_PROPERTY_TYPE%7CHotel&locusId=CTDEL&locusType=city&regionNearByExp=3&roomStayQualifier=2e0e&rsc=1e2e0e&searchText=Delhi", driver.getCurrentUrl());
		WebElement appliedFilter = driver.findElement(By.xpath("//div[@class=\"appendBottom15 bdrBottom\"]/child::div/child::span"));  		
		Assert.assertTrue(appliedFilter.isDisplayed(), "Applied Filters");
	}
	@AfterStep
	public static void takeScreendown(Scenario scenerio) {
		   TakesScreenshot ts= (TakesScreenshot) driver;
		   final byte[] src = ts.getScreenshotAs(OutputType.BYTES);
		   scenerio.attach(src, "image/png",scenerio.getName());
	}
}